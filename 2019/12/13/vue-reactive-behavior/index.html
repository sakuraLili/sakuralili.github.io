<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue源码解读（一）：响应式数据 | 既然选择了远方，便只顾风雨兼程</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link ref="icon" href="./public/favicon.icon">
    <meta name="description" content="此文章是基于 Vue 2 版本

先看个例子：

var vm = new Vue({
  props: {
    rootProp: Boolean
  },
  data {
    a: &#39;&#39;,
    b: &#39;&#39;
  },
  computed: {
    rootCompute () {
      return &#39;&#39;
    }
  },
  watch: {
 ...">
    
    <link rel="preload" href="/assets/css/0.styles.730f6d4f.css" as="style"><link rel="preload" href="/assets/js/app.c4cd884f.js" as="script"><link rel="preload" href="/assets/js/23.d4940eec.js" as="script"><link rel="preload" href="/assets/js/5.5d32c9ea.js" as="script"><link rel="preload" href="/assets/js/17.cf1e4c9d.js" as="script"><link rel="prefetch" href="/assets/js/10.a13898e2.js"><link rel="prefetch" href="/assets/js/11.ea480a48.js"><link rel="prefetch" href="/assets/js/12.0623054f.js"><link rel="prefetch" href="/assets/js/13.ef25626c.js"><link rel="prefetch" href="/assets/js/14.37d92c2e.js"><link rel="prefetch" href="/assets/js/15.186b7794.js"><link rel="prefetch" href="/assets/js/16.3a23dbe1.js"><link rel="prefetch" href="/assets/js/18.733102b1.js"><link rel="prefetch" href="/assets/js/19.eb455b58.js"><link rel="prefetch" href="/assets/js/20.e1adbccc.js"><link rel="prefetch" href="/assets/js/21.70504574.js"><link rel="prefetch" href="/assets/js/22.a40e7218.js"><link rel="prefetch" href="/assets/js/24.e000ab2c.js"><link rel="prefetch" href="/assets/js/25.2fe1472c.js"><link rel="prefetch" href="/assets/js/26.84502e94.js"><link rel="prefetch" href="/assets/js/27.c5d352fe.js"><link rel="prefetch" href="/assets/js/28.8e4ee861.js"><link rel="prefetch" href="/assets/js/29.fb15a9ed.js"><link rel="prefetch" href="/assets/js/3.2bd813b0.js"><link rel="prefetch" href="/assets/js/30.baf8f290.js"><link rel="prefetch" href="/assets/js/31.369fdd21.js"><link rel="prefetch" href="/assets/js/32.c0176c82.js"><link rel="prefetch" href="/assets/js/33.b3200294.js"><link rel="prefetch" href="/assets/js/34.08880f00.js"><link rel="prefetch" href="/assets/js/35.133a227c.js"><link rel="prefetch" href="/assets/js/36.293f2b2b.js"><link rel="prefetch" href="/assets/js/37.f92a5aa5.js"><link rel="prefetch" href="/assets/js/38.11242c63.js"><link rel="prefetch" href="/assets/js/39.1540f3d9.js"><link rel="prefetch" href="/assets/js/4.dde594c9.js"><link rel="prefetch" href="/assets/js/40.bc77545d.js"><link rel="prefetch" href="/assets/js/41.fe6b364e.js"><link rel="prefetch" href="/assets/js/42.6b17d3ae.js"><link rel="prefetch" href="/assets/js/43.d988bf22.js"><link rel="prefetch" href="/assets/js/44.9b709226.js"><link rel="prefetch" href="/assets/js/45.0797ebde.js"><link rel="prefetch" href="/assets/js/46.d41406d1.js"><link rel="prefetch" href="/assets/js/47.26d992a5.js"><link rel="prefetch" href="/assets/js/48.edf0660d.js"><link rel="prefetch" href="/assets/js/49.e1bd4b64.js"><link rel="prefetch" href="/assets/js/50.17997f4a.js"><link rel="prefetch" href="/assets/js/51.0731d59f.js"><link rel="prefetch" href="/assets/js/52.718863ae.js"><link rel="prefetch" href="/assets/js/53.4d2f7088.js"><link rel="prefetch" href="/assets/js/54.91ac93f6.js"><link rel="prefetch" href="/assets/js/55.3216e5c5.js"><link rel="prefetch" href="/assets/js/56.a2736731.js"><link rel="prefetch" href="/assets/js/57.93476b89.js"><link rel="prefetch" href="/assets/js/58.9984e9d6.js"><link rel="prefetch" href="/assets/js/59.27eeb159.js"><link rel="prefetch" href="/assets/js/6.e9162c19.js"><link rel="prefetch" href="/assets/js/60.83f3f7cd.js"><link rel="prefetch" href="/assets/js/61.322f6435.js"><link rel="prefetch" href="/assets/js/62.af66f292.js"><link rel="prefetch" href="/assets/js/63.777e9119.js"><link rel="prefetch" href="/assets/js/64.05118592.js"><link rel="prefetch" href="/assets/js/65.9ba14b43.js"><link rel="prefetch" href="/assets/js/66.62408b82.js"><link rel="prefetch" href="/assets/js/67.fa72ffa1.js"><link rel="prefetch" href="/assets/js/68.c16dfb41.js"><link rel="prefetch" href="/assets/js/7.f41c39e4.js"><link rel="prefetch" href="/assets/js/8.cd0ad175.js"><link rel="prefetch" href="/assets/js/9.f1977faa.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.8fa4990d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.730f6d4f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">既然选择了远方，便只顾风雨兼程 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="nav-item"><a href="/2019/10/20/base-list/" class="nav-link">学习资源</a></li><li class="nav-item"><a href="/handbook/" class="nav-link">前端学习手册</a></li><li class="nav-item"><a href="/tag/Reading%20Notes/" class="nav-link">读书笔记</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">既然选择了远方，便只顾风雨兼程 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="mobile-nav-item"><a href="/2019/10/20/base-list/" class="nav-link">学习资源</a></li><li class="mobile-nav-item"><a href="/handbook/" class="nav-link">前端学习手册</a></li><li class="mobile-nav-item"><a href="/tag/Reading%20Notes/" class="nav-link">读书笔记</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        Vue源码解读（一）：响应式数据
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">lili</span> <span itemprop="address">   in shenzhen</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2019-12-13T00:00:00.000Z">
      Fri Dec 13 2019
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/JavaScript" data-v-42ccfcd5><span data-v-42ccfcd5>JavaScript</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/Vue" data-v-42ccfcd5><span data-v-42ccfcd5>Vue</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><blockquote><p>此文章是基于 Vue 2 版本</p></blockquote> <p>先看个例子：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> vm <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">props</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rootProp</span><span class="token operator">:</span> Boolean
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  data <span class="token punctuation">{</span>
    <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token string">''</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">computed</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">rootCompute</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">''</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">watch</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token function">rootWatcher</span> <span class="token punctuation">(</span><span class="token parameter">newVal<span class="token punctuation">,</span> oldVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>在上面的代码中，我们创建了一个<code>Vue</code>实例，并且我们给了它一个<strong>选项对象</strong>来进行初始化。</p> <p>下面我们将根据<code>Vue</code>源码来说明<code>Vue</code>是如何实现响应式的。</p> <h3 id="vue项目结构"><a href="#vue项目结构" class="header-anchor">#</a> <code>Vue</code>项目结构</h3> <p>在<code>github</code>上将<code>Vue</code>的源码<code>clone</code>到本地，我们可以看到，<code>Vue</code>的源码目录结构主要如下：</p> <p><img src="/assets/img/1.f09c244b.png" alt="image from dependency"></p> <h3 id="vue入口文件"><a href="#vue入口文件" class="header-anchor">#</a> <code>Vue</code>入口文件</h3> <p><code>Vue</code>在入口文件是<code>src/core/index.js</code>，其中简化的代码如下：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/core/index.js</span>
<span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'./instance/index'</span>
<span class="token comment">// ...</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Vue
</code></pre></div><p>从代码中，我们可以发现，在这个文件中，我们导出了一个<code>Vue</code>实例。那么初始化<code>Vue</code>实例则是在<code>src/core/instance/index.js</code>文件中完成的。</p> <h3 id="vue实例的初始化"><a href="#vue实例的初始化" class="header-anchor">#</a> <code>Vue</code>实例的初始化</h3> <p><code>Vue</code>实例的初始化包括一系列的数据初始化,它的目录结构如下：</p> <p><img src="/assets/img/2.ded75b44.png" alt="image from dependency"></p> <p>来到<code>index.js</code>中</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/core/instance/index.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> initMixin <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./init'</span>
<span class="token keyword">function</span> <span class="token function">Vue</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">_init</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">initMixin</span><span class="token punctuation">(</span>Vue<span class="token punctuation">)</span>
<span class="token comment">// ...</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Vue
</code></pre></div><p>从代码中，我们可以看出<code>Vue</code>是一个构造函数，创建<code>Vue</code>实例时，我们会执行<code>_init</code>函数，那么 <code>_init</code>函数到底做了什么？又定义在哪呢？在说<code>_init</code>函数之前，我们先来看看<code>initMixin</code>函数。</p> <p><code>initMixin</code>函数是在创建实例之前就执行多的，我们来看看<code>initMixin</code>函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/core/instance/init.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> initState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./state'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initMixin</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">Vue</span><span class="token operator">:</span> Class<span class="token operator">&lt;</span>Component<span class="token operator">&gt;</span></span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">_init</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">options<span class="token operator">?</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token literal-property property">vm</span><span class="token operator">:</span> Component <span class="token operator">=</span> <span class="token keyword">this</span>
    <span class="token function">initLifecycle</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// vm 生命周期相关变量初始化操作</span>
    <span class="token function">initEvents</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>    <span class="token comment">// vm 事件相关初始化</span>
    <span class="token function">initRender</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>    <span class="token comment">// 模板解析相关初始化</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'beforeCreate'</span><span class="token punctuation">)</span> <span class="token comment">// 调用 beforeCreate 钩子函数</span>
    <span class="token function">initInjections</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve injections before data/props</span>
    <span class="token function">initState</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>  <span class="token comment">// vm 状态初始化</span>
    <span class="token function">initProvide</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span> <span class="token comment">// resolve provide after data/props</span>
    <span class="token function">callHook</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> <span class="token string">'created'</span><span class="token punctuation">)</span> <span class="token comment">// 调用 created 钩子函数</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>从这里我们可以看出，<code>Vue</code>构造函数中的<code>_init</code>函数在这里有定义， 所以运行<code>new Vue()</code>时， <code>_init</code>函数就会进行一系列的初始化，包括<code>Vue</code>实例的生命周期，事件、数据等</p> <p>我们的重点在<code>initState(vm)</code>，里面实现了<code>props</code>, <code>methods</code>,<code>data</code>,<code>computed</code>,<code>watch</code>的初始化操作。我们来看看源码</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/core/instance/state.js</span>
<span class="token keyword">import</span> Watcher <span class="token keyword">from</span> <span class="token string">'../observer/watcher'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> pushTarget<span class="token punctuation">,</span> popTarget <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../observer/dep'</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> observe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../observer/index'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">initState</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">vm</span><span class="token operator">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  vm<span class="token punctuation">.</span>_watchers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token keyword">const</span> opts <span class="token operator">=</span> vm<span class="token punctuation">.</span>$options
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span> <span class="token function">initProps</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>props<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>methods<span class="token punctuation">)</span> <span class="token function">initMethods</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>methods<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initData</span><span class="token punctuation">(</span>vm<span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">observe</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* asRootData */</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>computed<span class="token punctuation">)</span> <span class="token function">initComputed</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>computed<span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>opts<span class="token punctuation">.</span>watch <span class="token operator">&amp;&amp;</span> opts<span class="token punctuation">.</span>watch <span class="token operator">!==</span> nativeWatch<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">initWatch</span><span class="token punctuation">(</span>vm<span class="token punctuation">,</span> opts<span class="token punctuation">.</span>watch<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>代码中的<code>vm.$options</code>就是<strong>选项对象</strong>，它也是在<code>_init</code>函数中赋值的。</p> <p>根据代码，我们也可以得到选项对象初始化的顺序：</p> <p><img src="data:image/png;base64,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" alt="image from dependency"></p> <p>我们先来说说<code>data</code>的初始化</p> <h3 id="初始化data"><a href="#初始化data" class="header-anchor">#</a> 初始化<code>Data</code></h3> <p>熟悉<code>Vue</code>的朋友都知道，在<code>Vue</code>组件中，<code>data</code>被要求是一个函数，所以对于<code>data</code>的初始化是执行<code>initData(vm)</code>函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/core/instance/state.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> observe <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../observer/index'</span>
<span class="token keyword">function</span> <span class="token function">initData</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">vm</span><span class="token operator">:</span> Component</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//...</span>
  <span class="token function">observe</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* asRootData */</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>代码中<code>observe</code>是在其他地方定义的，它的参数<code>data</code>是组件中<code>data</code>函数的返回值，比如上面的例子，此时参数<code>data</code>就是对象<code>{ a: '', b: '' }</code></p> <p>那我们接着来看<code>observe</code>函数</p> <h4 id="observer-观察者"><a href="#observer-观察者" class="header-anchor">#</a> <code>Observer</code>（观察者）</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/core/observe/index.js</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">observe</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">value</span><span class="token operator">:</span> any<span class="token punctuation">,</span> <span class="token literal-property property">asRootData</span><span class="token operator">:</span> <span class="token operator">?</span>boolean</span><span class="token punctuation">)</span><span class="token operator">:</span> Observer <span class="token operator">|</span> <span class="token keyword">void</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> <span class="token literal-property property">ob</span><span class="token operator">:</span> Observer <span class="token operator">|</span> <span class="token keyword">void</span>
  ob <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
  <span class="token keyword">return</span> ob
<span class="token punctuation">}</span>
</code></pre></div><p>其中，<code>observe</code>实例化了<code>Observer</code>对象，参数为对象<code>{ a: '', b: '' }</code>。</p> <p>现在我们来看看<code>Observer</code>做了什么</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/core/observe/index.js</span>
<span class="token keyword">import</span> Dep <span class="token keyword">from</span> <span class="token string">'./dep'</span>

<span class="token keyword">export</span> <span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> any<span class="token punctuation">;</span>
  <span class="token literal-property property">dep</span><span class="token operator">:</span> Dep<span class="token punctuation">;</span>
  <span class="token literal-property property">vmCount</span><span class="token operator">:</span> number<span class="token punctuation">;</span> <span class="token comment">// number of vms that have this object as root $data</span>
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">value</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
    <span class="token keyword">this</span><span class="token punctuation">.</span>dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>vmCount <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">walk</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 遍历对象，通过 defineProperty 函数实现双向绑定</span>
  <span class="token function">walk</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">obj</span><span class="token operator">:</span> Object</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">defineReactive</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> keys<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre></div><p>类<code>Observer</code>在初始化时保存了传进来的<code>data</code>，并且实例化了一个<code>Dep</code>。</p> <p>当<code>data</code>为对象时，调用了<code>walk</code>函数， 遍历了对象的每个属性，并且调用了<code>defineReactive</code>函数，对每个属性实现双向绑定。</p> <p>下面我们来看看<code>defineReactive</code>的具体实现</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Define a reactive property on an Object.</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">defineReactive</span> <span class="token punctuation">(</span>
  <span class="token parameter"><span class="token literal-property property">obj</span><span class="token operator">:</span> Object<span class="token punctuation">,</span>
  <span class="token literal-property property">key</span><span class="token operator">:</span> string<span class="token punctuation">,</span>
  <span class="token literal-property property">val</span><span class="token operator">:</span> any<span class="token punctuation">,</span>
  customSetter<span class="token operator">?</span><span class="token operator">:</span> <span class="token operator">?</span>Function<span class="token punctuation">,</span>
  shallow<span class="token operator">?</span><span class="token operator">:</span> boolean</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> dep <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Dep</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> property <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">getOwnPropertyDescriptor</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">)</span>

  <span class="token keyword">const</span> getter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>get
  <span class="token keyword">const</span> setter <span class="token operator">=</span> property <span class="token operator">&amp;&amp;</span> property<span class="token punctuation">.</span>set
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">!</span>getter <span class="token operator">||</span> setter<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> arguments<span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    val <span class="token operator">=</span> obj<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> childOb <span class="token operator">=</span> <span class="token operator">!</span>shallow <span class="token operator">&amp;&amp;</span> <span class="token function">observe</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>
  Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">enumerable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">configurable</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// 拦截 getter，当取值时会触发该函数</span>
    <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveGetter</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">:</span> val
      <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dep<span class="token punctuation">.</span><span class="token function">depend</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> value
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// 拦截 setter，当赋值时会触发该函数</span>
    <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token function">reactiveSetter</span> <span class="token punctuation">(</span><span class="token parameter">newVal</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> value <span class="token operator">=</span> getter <span class="token operator">?</span> <span class="token function">getter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token operator">:</span> val
      <span class="token comment">// ...</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>getter <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>setter<span class="token punctuation">)</span> <span class="token keyword">return</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>setter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">setter</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> newVal<span class="token punctuation">)</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        val <span class="token operator">=</span> newVal
      <span class="token punctuation">}</span>
      <span class="token comment">// ...</span>
      dep<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>defineReactive</code>函数利用了<code>Object.defineProperty()</code>对对象属性进行了重写，并且每个属性都有一个<code>Dep</code>实例</p> <p>在<code>Object.defineProperty</code>中自定义<code>get</code>和<code>set</code>函数，并在<code>get</code>中进行依赖收集，在<code>set</code>中派发更新。</p> <p>其中，<code>dep</code>是<code>Dep</code>的实例，那<code>Dep</code>到底是什么呢？</p> <p>—— <code>Dep</code>其实是一个订阅者的管理中心，管理着所有的订阅者</p> <p>下面我们来看看<code>Dep</code></p> <h3 id="dep-订阅者管理中心"><a href="#dep-订阅者管理中心" class="header-anchor">#</a> <code>Dep</code>（订阅者管理中心）</h3> <p>给<code>data</code>属性添加订阅者有一个前提条件 —— <code>Dep.target</code>存在，那<code>Dep.target</code>是什么呢？</p> <p>我们来看<code>src/core/observe/dep.js</code>中关于<code>Dep</code>的代码：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/core/observe/dep.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Dep</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> <span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token operator">?</span>Watcher<span class="token punctuation">;</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> number<span class="token punctuation">;</span>
  <span class="token literal-property property">subs</span><span class="token operator">:</span> Array<span class="token operator">&lt;</span>Watcher<span class="token operator">&gt;</span><span class="token punctuation">;</span>

  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> uid<span class="token operator">++</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 添加观察者</span>
  <span class="token function">addSub</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">sub</span><span class="token operator">:</span> Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>sub<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 移除观察者</span>
  <span class="token function">removeSub</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">sub</span><span class="token operator">:</span> Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">remove</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">,</span> sub<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token function">depend</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>Dep<span class="token punctuation">.</span>target<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 调用 Watcher 的 addDep 函数</span>
      Dep<span class="token punctuation">.</span>target<span class="token punctuation">.</span><span class="token function">addDep</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 派发更新</span>
  <span class="token function">notify</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// stabilize the subscriber list first</span>
    <span class="token keyword">const</span> subs <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>subs<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> subs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      subs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">const</span> targetStack <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">pushTarget</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">target</span><span class="token operator">:</span> <span class="token operator">?</span>Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  targetStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span>
  Dep<span class="token punctuation">.</span>target <span class="token operator">=</span> target
<span class="token punctuation">}</span>
</code></pre></div><p>从代码中，我们可以发现:</p> <ol><li>在<code>Dep</code>中分别定义了<code>get</code>和<code>set</code>中需要用的<code>depend</code>和<code>notify</code>函数，并且可以发现<code>depend</code>是添加一个订阅者，<code>notify</code>是用来更新订阅者的</li> <li><code>Dep</code>通过静态属性<code>target</code>来控制在同一时间内只有一个观察者，并且通过<code>pushTarget</code>来给<code>target</code>属性赋值。</li> <li><code>Dep</code>中方法主要是对<code>Watcher</code>队列进行增加、移除，所以<code>Dep</code>其实是<code>Watcher</code>管理中心，管理着所有的<code>Watcher</code>。</li></ol> <p>下面我们来看看<code>Watcher</code>：</p> <h3 id="watcher-订阅者"><a href="#watcher-订阅者" class="header-anchor">#</a> <code>Watcher</code>（订阅者）</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/core/observe/watcher.js</span>
<span class="token keyword">import</span> Dep<span class="token punctuation">,</span> <span class="token punctuation">{</span> pushTarget<span class="token punctuation">,</span> popTarget <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./dep'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Watcher</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  <span class="token literal-property property">id</span><span class="token operator">:</span> number
  <span class="token function">constructor</span> <span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token operator">++</span>uid
  <span class="token punctuation">}</span>
  <span class="token function">addDep</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">dep</span><span class="token operator">:</span> Dep</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> id <span class="token operator">=</span> dep<span class="token punctuation">.</span>id
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>newDepIds<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>newDeps<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>dep<span class="token punctuation">)</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>depIds<span class="token punctuation">.</span><span class="token function">has</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dep<span class="token punctuation">.</span><span class="token function">addSub</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token function">update</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">/* istanbul ignore else */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>lazy<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>dirty <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sync<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 一般会进入这里</span>
      <span class="token function">queueWatcher</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// src/core/observe/scheduler.js</span>
<span class="token keyword">let</span> flushing <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">queueWatcher</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">watcher</span><span class="token operator">:</span> Watcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id
  <span class="token comment">// 判断 Watcher 是否 push 过</span>
  <span class="token comment">// 因为存在改变了多个数据，多个数据的 Watch 是同一个</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>flushing<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 最初会进入这个条件</span>
      queue<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>watcher<span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 在执行 flushSchedulerQueue 函数时，如果有新的派发更新会进入这里</span>
      <span class="token comment">// 插入新的 watcher</span>
      <span class="token keyword">let</span> i <span class="token operator">=</span> queue<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span>
      <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&gt;</span> index <span class="token operator">&amp;&amp;</span> queue<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>id <span class="token operator">&gt;</span> watcher<span class="token punctuation">.</span>id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        i<span class="token operator">--</span>
      <span class="token punctuation">}</span>
      queue<span class="token punctuation">.</span><span class="token function">splice</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> watcher<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 最初会进入这个条件</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>waiting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      waiting <span class="token operator">=</span> <span class="token boolean">true</span>

      <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>config<span class="token punctuation">.</span>async<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">flushSchedulerQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span>
      <span class="token punctuation">}</span>
      <span class="token comment">// 将所有 Watcher 统一放入 nextTick 调用</span>
      <span class="token comment">// 因为每次派发更新都会引发渲染</span>
      <span class="token function">nextTick</span><span class="token punctuation">(</span>flushSchedulerQueue<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">flushSchedulerQueue</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  currentFlushTimestamp <span class="token operator">=</span> <span class="token function">getNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  flushing <span class="token operator">=</span> <span class="token boolean">true</span>
  <span class="token keyword">let</span> watcher<span class="token punctuation">,</span> id

  <span class="token comment">// 根据 id 排序 watch，确保：</span>
  <span class="token comment">// 1. 组件更新从父到子</span>
  <span class="token comment">// 2. 用户写的 Watch 先于渲染 Watch</span>
  <span class="token comment">// 3. 如果在父组件 watch run 的时候有组件销毁了，这个 Watch 可以被跳过</span>
  queue<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> a<span class="token punctuation">.</span>id <span class="token operator">-</span> b<span class="token punctuation">.</span>id<span class="token punctuation">)</span>

  <span class="token comment">// 不缓存队列长度，因为在遍历的过程中可能队列的长度发生变化</span>
  <span class="token keyword">for</span> <span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> queue<span class="token punctuation">.</span>length<span class="token punctuation">;</span> index<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    watcher <span class="token operator">=</span> queue<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>watcher<span class="token punctuation">.</span>before<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 执行 beforeUpdate 钩子函数</span>
      watcher<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    id <span class="token operator">=</span> watcher<span class="token punctuation">.</span>id
    has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token comment">// 在这里执行用户写的 Watch 的回调函数并且渲染组件</span>
    watcher<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 判断无限循环</span>
    <span class="token comment">// 比如在 watch 中又重新给对象赋值了，就会出现这个情况</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span> <span class="token operator">&amp;&amp;</span> has<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      circular<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>circular<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>circular<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token constant">MAX_UPDATE_COUNT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
        <span class="token keyword">break</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>在派发更新的全过程中，核心流程就是给对象赋值，触发<code>set</code>中的派发更新函数。将所有<code>Watcher</code>都放入<code>nextTick</code>中进行更新，<code>nextTick</code>回调中执行用户<code>Watch</code>的回调函数并且渲染组件。</p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <ol><li><code>Vue</code>中数据响应原理主要涉及到下面几个类</li></ol> <p><img src="data:image/png;base64,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" alt="image from dependency"></p> <p>下图是类中的一些属性和方法</p> <p><img src="/assets/img/5.4fe42a7b.png" alt="image from dependency"></p> <ol start="2"><li>下图是几个类的关联</li></ol> <p><img src="/assets/img/6.f71348b2.png" alt="image from dependency"></p> <ul><li>图中的红色箭头是<code>Watcher</code>的实例化。在实例化的过程中，会调用方法<code>get</code>来设置<code>Dep.target</code>为当前<code>Watcher</code>实例，并且触发观察对象的<code>getter</code>方法，进行依赖收集。</li> <li>图中的蓝色箭头是依赖收集的过程。观察对象的<code>getter</code>方法被触发，经过<code>dep.depend()</code>、<code>Dep.target.addDep()</code>和<code>dep.addSub()</code>等方法，会将当前观察对象的<code>dep</code>实例添加到<code>Watcher</code> 实例的<code>deps</code>中，并且将当前<code>Watcher</code>实例添加到<code>Dep</code>的属性<code>subs</code>中进行统一管理。</li> <li>图中的黄色箭头是派发更新过程。当观察对象改变后，会调用<code>dep.notify()</code>方法，触发<code>subs</code>中当前的<code>watcher1</code>实例的<code>update</code>方法，最后会重新渲染。</li></ul></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h3 active"><a href="#vue项目结构" title="Vue 项目结构">Vue 项目结构</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#vue入口文件" title="Vue 入口文件">Vue 入口文件</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#vue实例的初始化" title="Vue 实例的初始化">Vue 实例的初始化</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#初始化data" title="初始化 Data">初始化 Data</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#dep-订阅者管理中心" title="Dep （订阅者管理中心）">Dep （订阅者管理中心）</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#watcher-订阅者" title="Watcher （订阅者）">Watcher （订阅者）</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#总结" title="总结">总结</a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c4cd884f.js" defer></script><script src="/assets/js/23.d4940eec.js" defer></script><script src="/assets/js/5.5d32c9ea.js" defer></script><script src="/assets/js/17.cf1e4c9d.js" defer></script>
  </body>
</html>
