<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>eureka-js-client：Nodejs 与 Java 的通讯 | 既然选择了远方，便只顾风雨兼程</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link ref="icon" href="./public/favicon.icon">
    <meta name="description" content="eureka-js-client 是 Eureka 客户端的 JavaScript 实现。

&gt;  Eureka 是一种 RESTful （表现层状态转化）服务，主要用于 AWS 云中，用于中间层服务器的发现、负载 ...">
    
    <link rel="preload" href="/assets/css/0.styles.730f6d4f.css" as="style"><link rel="preload" href="/assets/js/app.c4cd884f.js" as="script"><link rel="preload" href="/assets/js/23.d4940eec.js" as="script"><link rel="preload" href="/assets/js/5.5d32c9ea.js" as="script"><link rel="preload" href="/assets/js/37.f92a5aa5.js" as="script"><link rel="prefetch" href="/assets/js/10.a13898e2.js"><link rel="prefetch" href="/assets/js/11.ea480a48.js"><link rel="prefetch" href="/assets/js/12.0623054f.js"><link rel="prefetch" href="/assets/js/13.ef25626c.js"><link rel="prefetch" href="/assets/js/14.37d92c2e.js"><link rel="prefetch" href="/assets/js/15.186b7794.js"><link rel="prefetch" href="/assets/js/16.3a23dbe1.js"><link rel="prefetch" href="/assets/js/17.cf1e4c9d.js"><link rel="prefetch" href="/assets/js/18.733102b1.js"><link rel="prefetch" href="/assets/js/19.eb455b58.js"><link rel="prefetch" href="/assets/js/20.e1adbccc.js"><link rel="prefetch" href="/assets/js/21.70504574.js"><link rel="prefetch" href="/assets/js/22.a40e7218.js"><link rel="prefetch" href="/assets/js/24.e000ab2c.js"><link rel="prefetch" href="/assets/js/25.2fe1472c.js"><link rel="prefetch" href="/assets/js/26.84502e94.js"><link rel="prefetch" href="/assets/js/27.c5d352fe.js"><link rel="prefetch" href="/assets/js/28.8e4ee861.js"><link rel="prefetch" href="/assets/js/29.fb15a9ed.js"><link rel="prefetch" href="/assets/js/3.2bd813b0.js"><link rel="prefetch" href="/assets/js/30.baf8f290.js"><link rel="prefetch" href="/assets/js/31.369fdd21.js"><link rel="prefetch" href="/assets/js/32.c0176c82.js"><link rel="prefetch" href="/assets/js/33.b3200294.js"><link rel="prefetch" href="/assets/js/34.08880f00.js"><link rel="prefetch" href="/assets/js/35.133a227c.js"><link rel="prefetch" href="/assets/js/36.293f2b2b.js"><link rel="prefetch" href="/assets/js/38.11242c63.js"><link rel="prefetch" href="/assets/js/39.1540f3d9.js"><link rel="prefetch" href="/assets/js/4.dde594c9.js"><link rel="prefetch" href="/assets/js/40.bc77545d.js"><link rel="prefetch" href="/assets/js/41.fe6b364e.js"><link rel="prefetch" href="/assets/js/42.6b17d3ae.js"><link rel="prefetch" href="/assets/js/43.d988bf22.js"><link rel="prefetch" href="/assets/js/44.9b709226.js"><link rel="prefetch" href="/assets/js/45.0797ebde.js"><link rel="prefetch" href="/assets/js/46.d41406d1.js"><link rel="prefetch" href="/assets/js/47.26d992a5.js"><link rel="prefetch" href="/assets/js/48.edf0660d.js"><link rel="prefetch" href="/assets/js/49.e1bd4b64.js"><link rel="prefetch" href="/assets/js/50.17997f4a.js"><link rel="prefetch" href="/assets/js/51.0731d59f.js"><link rel="prefetch" href="/assets/js/52.718863ae.js"><link rel="prefetch" href="/assets/js/53.4d2f7088.js"><link rel="prefetch" href="/assets/js/54.91ac93f6.js"><link rel="prefetch" href="/assets/js/55.3216e5c5.js"><link rel="prefetch" href="/assets/js/56.a2736731.js"><link rel="prefetch" href="/assets/js/57.93476b89.js"><link rel="prefetch" href="/assets/js/58.9984e9d6.js"><link rel="prefetch" href="/assets/js/59.27eeb159.js"><link rel="prefetch" href="/assets/js/6.e9162c19.js"><link rel="prefetch" href="/assets/js/60.83f3f7cd.js"><link rel="prefetch" href="/assets/js/61.322f6435.js"><link rel="prefetch" href="/assets/js/62.af66f292.js"><link rel="prefetch" href="/assets/js/63.777e9119.js"><link rel="prefetch" href="/assets/js/64.05118592.js"><link rel="prefetch" href="/assets/js/65.9ba14b43.js"><link rel="prefetch" href="/assets/js/66.62408b82.js"><link rel="prefetch" href="/assets/js/67.fa72ffa1.js"><link rel="prefetch" href="/assets/js/68.c16dfb41.js"><link rel="prefetch" href="/assets/js/7.f41c39e4.js"><link rel="prefetch" href="/assets/js/8.cd0ad175.js"><link rel="prefetch" href="/assets/js/9.f1977faa.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.8fa4990d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.730f6d4f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">既然选择了远方，便只顾风雨兼程 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="nav-item"><a href="/2019/10/20/base-list/" class="nav-link">学习资源</a></li><li class="nav-item"><a href="/handbook/" class="nav-link">前端学习手册</a></li><li class="nav-item"><a href="/tag/Reading%20Notes/" class="nav-link">读书笔记</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">既然选择了远方，便只顾风雨兼程 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="mobile-nav-item"><a href="/2019/10/20/base-list/" class="nav-link">学习资源</a></li><li class="mobile-nav-item"><a href="/handbook/" class="nav-link">前端学习手册</a></li><li class="mobile-nav-item"><a href="/tag/Reading%20Notes/" class="nav-link">读书笔记</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        eureka-js-client：Nodejs 与 Java 的通讯
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">lili</span> <span itemprop="address">   in shenzhen</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2021-09-07T00:00:00.000Z">
      Tue Sep 07 2021
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/Node.js" data-v-42ccfcd5><span data-v-42ccfcd5>Node.js</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/JavaScript" data-v-42ccfcd5><span data-v-42ccfcd5>JavaScript</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p><a href="https://github.com/jquatier/eureka-js-client" target="_blank" rel="noopener noreferrer">eureka-js-client<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 是 <a href="https://github.com/Netflix/eureka" target="_blank" rel="noopener noreferrer">Eureka<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 客户端的<code>JavaScript</code>实现。</p> <blockquote><p><code>Eureka</code>是一种<code>RESTful</code>（表现层状态转化）服务，主要用于<code>AWS</code>云中，用于中间层服务器的发现、负载平衡和故障转移。它在<code>Netflix</code>中端基础设施中发挥着关键作用。</p></blockquote> <p><img src="/assets/img/01.223caea5.jpg" alt="image from dependency"></p> <h2 id="使用方法"><a href="#使用方法" class="header-anchor">#</a> 使用方法</h2> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">npm</span> <span class="token function">install</span> eureka-js-client <span class="token parameter variable">--save</span>
</code></pre></div><h3 id="在nodejs应用中加入eureka客户端"><a href="#在nodejs应用中加入eureka客户端" class="header-anchor">#</a> 在<code>Nodejs</code>应用中加入<code>Eureka</code>客户端</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> Eureka <span class="token keyword">from</span> <span class="token string">'eureka-js-client'</span><span class="token punctuation">;</span>

<span class="token comment">// Or, if you're not using a transpiler:</span>
<span class="token keyword">const</span> Eureka <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'eureka-js-client'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Eureka<span class="token punctuation">;</span>

<span class="token comment">// example configuration</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Eureka</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// application instance information</span>
  <span class="token literal-property property">instance</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">app</span><span class="token operator">:</span> <span class="token string">'jqservice'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">hostName</span><span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ipAddr</span><span class="token operator">:</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
    <span class="token literal-property property">vipAddress</span><span class="token operator">:</span> <span class="token string">'jq.test.something.com'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dataCenterInfo</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'MyOwn'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eureka</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// eureka server host / port</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'192.168.99.100'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">32768</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p><code>Eureka</code>会在当前工作目录下搜索<code>eureka-client.yml</code>这个配置文件，更进一步地，<code>Eureka</code>会根据不同的环境来覆盖<code>eureka-client.yml</code>，比如测试环境<code>eureka-client-test.yml</code>就会覆盖<code>eureka-client.yml</code>。</p> <p>当前环境是开发环境还是生产环境取决于环境变量。环境变量优先级的顺序：<code>EUREKA_ENV --&gt; NODE_ENV -&gt; development</code> (默认)</p> <p>传递给<code>Eureka</code>构造函数的选项将会覆盖配置文件中的值。</p> <p>你可以配置自定义的目录来加载配置文件，在传递给<code>Eureka</code>构造函数的选项中加上<code>cwd</code>属性就可以实现。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Eureka</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">cwd</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>__dirname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">/config</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="注册eureka-开始应该心跳"><a href="#注册eureka-开始应该心跳" class="header-anchor">#</a> 注册<code>Eureka</code>，开始应该心跳</h3> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="取消注册-停止心跳"><a href="#取消注册-停止心跳" class="header-anchor">#</a> 取消注册，停止心跳</h3> <div class="language-js extra-class"><pre class="language-js"><code>client<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="自定义请求中间件"><a href="#自定义请求中间件" class="header-anchor">#</a> 自定义请求中间件</h2> <p><code>eureka</code>客户端可以修改发送到<code>eureka</code>的<a href="https://www.npmjs.com/package/request" target="_blank" rel="noopener noreferrer">请求<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>选项对象，并且这种修改的优先级高于<code>eureka</code>的调用。当添加权限验证比如<code>OAuth</code>或者其他自定义请求头时，这是很有用的。每个<code>eureka</code>请求都会调用这个函数，因此它强烈建议对中间件中任何长期存在的外部调用进行缓存或记忆。如果中间件返回的不是对象，则<code>eureka</code>请求将立即失败，并执行重试，如果有配置重试。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Eureka</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token function-variable function">requestMiddleware</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">requestOpts<span class="token punctuation">,</span> done</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    requestOpts<span class="token punctuation">.</span>auth <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">user</span><span class="token operator">:</span> <span class="token string">'username'</span><span class="token punctuation">,</span>
      <span class="token literal-property property">password</span><span class="token operator">:</span> <span class="token string">'yourpassword'</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">done</span><span class="token punctuation">(</span>requestOpts<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="为aws环境配置"><a href="#为aws环境配置" class="header-anchor">#</a> 为<code>AWS</code>环境配置</h2> <p>对于<code>AWS</code>环境(<code>dataCenterInfo.name == 'Amazon'</code>)，客户端具有请求<code>Eureka</code>服务器所需的<code>AWS</code>元数据的内置逻辑。<a href="https://github.com/Netflix/eureka/wiki/Eureka-REST-operations" target="_blank" rel="noopener noreferrer">查看详情<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// example configuration for AWS</span>
<span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Eureka</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// application instance information</span>
  <span class="token literal-property property">instance</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">app</span><span class="token operator">:</span> <span class="token string">'jqservice'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span><span class="token punctuation">,</span>
    <span class="token literal-property property">vipAddress</span><span class="token operator">:</span> <span class="token string">'jq.test.something.com'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">statusPageUrl</span><span class="token operator">:</span> <span class="token string">'http://__HOST__:8080/info'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">healthCheckUrl</span><span class="token operator">:</span> <span class="token string">'http://__HOST__:8077/healthcheck'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">homePageUrl</span><span class="token operator">:</span> <span class="token string">'http://__HOST__:8080/'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">dataCenterInfo</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Amazon'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eureka</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// eureka server host / port / EC2 region</span>
    <span class="token literal-property property">host</span><span class="token operator">:</span> <span class="token string">'eureka.test.mydomain.com'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><p>注意：</p> <ol><li>在此配置下，实例<code>hostName</code>和<code>ipAddr</code>将被设置为<code>AWS</code>元数据提供的公共<code>host</code>和公共<code>IP</code>。你可以设置<code>eureka.useLocalMetadata</code>设置为<code>true</code>以使用私有主机和私有<code>IP</code>地址代替。</li> <li>如果需要使用<code>IP</code>地址作为主机名进行注册，请设置<code>eureka.preferIpAddress</code>为<code>true</code>。这可能与<code>eureka.useLocalMetadata</code>结合使用用于选择私有或公有<code>IP</code>。</li> <li>对于<code>status和healthcheck url</code>，您可以从元数据中使用<code>__HOST__</code>替换来作为主机。</li> <li>如果你想在<code>AWS</code>环境中提供自己的元数据，可以通过将<code>config.eureka.fetchMetadata</code>设置为<code>false</code>来禁用元数据获取。</li></ol> <h2 id="用dns来查找eureka服务器"><a href="#用dns来查找eureka服务器" class="header-anchor">#</a> 用<code>DNS</code>来查找<code>Eureka</code>服务器</h2> <p>如果你有多个可用性区域，并且根据<code>Wiki</code>文章<a href="https://github.com/Netflix/eureka/wiki/Deploying-Eureka-Servers-in-EC2#configuring-eips-using-dns" target="_blank" rel="noopener noreferrer">在<code>EC2</code>中部署<code>Eureka</code>服务器<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>设置了<code>DNS</code>条目，那么您需要将<code>config.eureka.useDns</code>设置为<code>true</code>并将<code>config.eureka.ec2Region</code>添加到当前区域(通常可以通过环境变量将其注入应用程序，或者在启动时直接传入)。</p> <p>这将导致客户端使用<code>config.eureka.host</code>和<code>config.eureka.ec2Region</code>执行<code>DNS</code>查找。上面的<code>Wiki</code>文章还描述了<code>DNS TXT</code>记录的命名约定。只要<code>DNS</code>记录符合相同的约定，这个特性也可以在非<code>ec2</code>环境中工作。默认情况下，<code>DNS</code>解析结果缓存在内存中，每<code>5</code>分钟刷新一次(设置<code>config.eureka.clusterRefreshInterval</code>来覆盖)。</p> <h3 id="地区亲和力"><a href="#地区亲和力" class="header-anchor">#</a> 地区亲和力</h3> <p>默认情况下，客户端将首先尝试连接与当前所在可用性区域相同的<code>Eureka</code>服务器。如果在实例元数据中没有设置<code>availability-zone</code>，那么将选择一个随机服务器。这也适用于静态配置集群(由<code>zone</code>映射，参见下面)。要禁用该特性，请将<code>config.eureka.preferSameZone</code>设置为<code>false</code>，然后将选择一个随机服务器。</p> <h2 id="配置静态的服务器列表"><a href="#配置静态的服务器列表" class="header-anchor">#</a> 配置静态的服务器列表</h2> <p>虽然推荐使用<code>DNS</code>(上面介绍的)方法来解析<code>Eureka</code>集群，但你也可以按区域静态配置<code>Eureka</code>服务器列表，或者只使用简单的默认列表。在使用这种方法时，请确保提供完整的协议、主机、端口和<code>Eureka REST</code>服务(通常是<code>/apps/</code>)的路径。</p> <h3 id="静态集群配置-按区域映射"><a href="#静态集群配置-按区域映射" class="header-anchor">#</a> 静态集群配置(按区域映射)</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Eureka</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">instance</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span> <span class="token comment">// application instance information</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eureka</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">availabilityZones</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'us-east-1'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'us-east-1c'</span><span class="token punctuation">,</span> <span class="token string">'us-east-1d'</span><span class="token punctuation">,</span> <span class="token string">'us-east-1e'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">serviceUrls</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token string-property property">'us-east-1c'</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'http://ec2-fake-552-627-568-165.compute-1.amazonaws.com:7001/eureka/v2/apps/'</span><span class="token punctuation">,</span>
        <span class="token string">'http://ec2-fake-368-101-182-134.compute-1.amazonaws.com:7001/eureka/v2/apps/'</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string-property property">'us-east-1d'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string-property property">'us-east-1e'</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="静态集群配置-列表"><a href="#静态集群配置-列表" class="header-anchor">#</a> 静态集群配置(列表)</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> client <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Eureka</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token literal-property property">instance</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span> <span class="token comment">// application instance information</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">eureka</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">serviceUrls</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'http://ec2-fake-552-627-568-165.compute-1.amazonaws.com:7001/eureka/v2/apps/'</span><span class="token punctuation">,</span>
        <span class="token string">'http://ec2-fake-368-101-182-134.compute-1.amazonaws.com:7001/eureka/v2/apps/'</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="高级配置选项"><a href="#高级配置选项" class="header-anchor">#</a> 高级配置选项</h2> <table><thead><tr><th>选项</th> <th>默认值</th> <th>描述</th></tr></thead> <tbody><tr><td><code>requestMiddleware</code></td> <td><code>noop</code></td> <td>自定义中间件函数来修改发送到<code>eureka</code>的<a href="https://www.npmjs.com/package/request" target="_blank" rel="noopener noreferrer">请求<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>选项</td></tr> <tr><td><code>logger</code></td> <td><code>console logging</code></td> <td><code>eureka</code>客户端中日志的实现</td></tr> <tr><td><code>shouldUseDelta</code></td> <td><code>false</code></td> <td>实验模式, 在更新时从<code>eureka</code>而不是完整注册表中获取增量</td></tr> <tr><td><code>eureka.maxRetries</code></td> <td><code>3</code></td> <td>所有请求重试发送到 <code>eureka</code>的次数</td></tr> <tr><td><code>eureka.requestRetryDelay</code></td> <td><code>500</code></td> <td>重试之间等待的毫秒数。这将乘以失败的重试次数。</td></tr> <tr><td><code>eureka.heartbeatInterval</code></td> <td><code>30000</code></td> <td>心跳之间间隔的毫秒数</td></tr> <tr><td><code>eureka.registryFetchInterval</code></td> <td><code>30000</code></td> <td>获取注册表之间等待的毫秒数</td></tr> <tr><td><code>eureka.registerWithEureka</code></td> <td><code>true</code></td> <td>是否开启<code>Eureka</code>注册</td></tr> <tr><td><code>eureka.fetchRegistry</code></td> <td><code>true</code></td> <td>是否开启获取注册表</td></tr> <tr><td><code>eureka.filterUpInstances</code></td> <td><code>true</code></td> <td>是否开启实例过滤，通过<code>status === UP</code></td></tr> <tr><td><code>eureka.servicePath</code></td> <td><code>/eureka/v2/apps/</code></td> <td><code>eureka REST</code>服务的路径</td></tr> <tr><td><code>eureka.ssl</code></td> <td><code>false</code></td> <td>是否开启<code>ssl</code>与<code>eureka</code>服务器的交互</td></tr> <tr><td><code>eureka.useDns</code></td> <td><code>false</code></td> <td>通过<code>DNS</code>来查找<code>Eureka</code>服务器，<a href="https://github.com/jquatier/eureka-js-client#looking-up-eureka-servers-in-aws-using-dns" target="_blank" rel="noopener noreferrer">详情<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr> <tr><td><code>eureka.preferSameZone</code></td> <td><code>true</code></td> <td>定位<code>Eureka</code>服务器时启用/禁用区域亲和性</td></tr> <tr><td><code>eureka.clusterRefreshInterval</code></td> <td><code>300000</code></td> <td>刷新集群主机之间等待的毫秒数(仅<code>DNS</code>解析)</td></tr> <tr><td><code>eureka.fetchMetadata</code></td> <td><code>true</code></td> <td>在<code>AWS</code>环境中获取<code>AWS</code>元数据，<a href="https://github.com/jquatier/eureka-js-client#configuring-for-aws-environments" target="_blank" rel="noopener noreferrer">详情<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr> <tr><td><code>eureka.useLocalMetadata</code></td> <td><code>false</code></td> <td>在<code>AWS</code>环境中使用元数据中的本地<code>IP</code>和本地主机名</td></tr> <tr><td><code>eureka.preferIpAddress</code></td> <td><code>false</code></td> <td>在<code>AWS</code>环境中使用<code>IP</code>地址(本地或公共)作为注册主机名</td></tr></tbody></table> <h2 id="事件"><a href="#事件" class="header-anchor">#</a> 事件</h2> <p><code>Eureka</code>客户端是<code>EventEmitter</code>的一个实例，提供了以下事件供消费:</p> <table><thead><tr><th><code>event</code></th> <th>提供的数据</th> <th>描述</th></tr></thead> <tbody><tr><td><code>started</code></td> <td><code>N/A</code></td> <td>当<code>eureka</code>客户端完全注册并更新所有注册表时触发。</td></tr> <tr><td><code>registered</code></td> <td><code>N/A</code></td> <td>当<code>eureka</code>客户端注册到<code>eureka</code>是触发</td></tr> <tr><td><code>deregistered</code></td> <td><code>N/A</code></td> <td>当<code>eureka</code>客户端取消注册时触发</td></tr> <tr><td><code>heartbeat</code></td> <td><code>N/A</code></td> <td>当<code>eureka</code>客户端成功更新与<code>eureka</code>的租约时触发。</td></tr> <tr><td><code>registryUpdated</code></td> <td><code>N/A</code></td> <td>当<code>eureka</code>客户端已成功更新其注册表时触发</td></tr></tbody></table></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#使用方法" title="使用方法">使用方法</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#安装" title="安装">安装</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#在nodejs应用中加入eureka客户端" title="在 Nodejs 应用中加入 Eureka 客户端">在 Nodejs 应用中加入 Eureka 客户端</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#注册eureka-开始应该心跳" title="注册 Eureka ，开始应该心跳">注册 Eureka ，开始应该心跳</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#取消注册-停止心跳" title="取消注册，停止心跳">取消注册，停止心跳</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#自定义请求中间件" title="自定义请求中间件">自定义请求中间件</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#为aws环境配置" title="为 AWS 环境配置">为 AWS 环境配置</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#用dns来查找eureka服务器" title="用 DNS 来查找 Eureka 服务器">用 DNS 来查找 Eureka 服务器</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#地区亲和力" title="地区亲和力">地区亲和力</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#配置静态的服务器列表" title="配置静态的服务器列表">配置静态的服务器列表</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#静态集群配置-按区域映射" title="静态集群配置(按区域映射)">静态集群配置(按区域映射)</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#静态集群配置-列表" title="静态集群配置(列表)">静态集群配置(列表)</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#高级配置选项" title="高级配置选项">高级配置选项</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#事件" title="事件">事件</a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c4cd884f.js" defer></script><script src="/assets/js/23.d4940eec.js" defer></script><script src="/assets/js/5.5d32c9ea.js" defer></script><script src="/assets/js/37.f92a5aa5.js" defer></script>
  </body>
</html>
