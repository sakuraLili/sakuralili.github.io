<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>GitHub + CircleCI 持续化构建博客 | 既然选择了远方，便只顾风雨兼程</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link ref="icon" href="./public/favicon.icon">
    <meta name="description" content="GitHub 能托管软件项目,对个人开发者来说十分友好，并且它还提供了GitHub Pages 功能，让我们可以搭建我们自己的个人博客网站。

关联账户

既然是构建自己的博客网站，就首先要有博客仓库，并且将仓库托管到 GitHub 上。这里是使用[VuePress](https:// ...">
    
    <link rel="preload" href="/assets/css/0.styles.730f6d4f.css" as="style"><link rel="preload" href="/assets/js/app.c4cd884f.js" as="script"><link rel="preload" href="/assets/js/23.d4940eec.js" as="script"><link rel="preload" href="/assets/js/5.5d32c9ea.js" as="script"><link rel="preload" href="/assets/js/9.f1977faa.js" as="script"><link rel="prefetch" href="/assets/js/10.a13898e2.js"><link rel="prefetch" href="/assets/js/11.ea480a48.js"><link rel="prefetch" href="/assets/js/12.0623054f.js"><link rel="prefetch" href="/assets/js/13.ef25626c.js"><link rel="prefetch" href="/assets/js/14.37d92c2e.js"><link rel="prefetch" href="/assets/js/15.186b7794.js"><link rel="prefetch" href="/assets/js/16.3a23dbe1.js"><link rel="prefetch" href="/assets/js/17.cf1e4c9d.js"><link rel="prefetch" href="/assets/js/18.733102b1.js"><link rel="prefetch" href="/assets/js/19.eb455b58.js"><link rel="prefetch" href="/assets/js/20.e1adbccc.js"><link rel="prefetch" href="/assets/js/21.70504574.js"><link rel="prefetch" href="/assets/js/22.a40e7218.js"><link rel="prefetch" href="/assets/js/24.e000ab2c.js"><link rel="prefetch" href="/assets/js/25.2fe1472c.js"><link rel="prefetch" href="/assets/js/26.84502e94.js"><link rel="prefetch" href="/assets/js/27.c5d352fe.js"><link rel="prefetch" href="/assets/js/28.8e4ee861.js"><link rel="prefetch" href="/assets/js/29.fb15a9ed.js"><link rel="prefetch" href="/assets/js/3.2bd813b0.js"><link rel="prefetch" href="/assets/js/30.baf8f290.js"><link rel="prefetch" href="/assets/js/31.369fdd21.js"><link rel="prefetch" href="/assets/js/32.c0176c82.js"><link rel="prefetch" href="/assets/js/33.b3200294.js"><link rel="prefetch" href="/assets/js/34.08880f00.js"><link rel="prefetch" href="/assets/js/35.133a227c.js"><link rel="prefetch" href="/assets/js/36.293f2b2b.js"><link rel="prefetch" href="/assets/js/37.f92a5aa5.js"><link rel="prefetch" href="/assets/js/38.11242c63.js"><link rel="prefetch" href="/assets/js/39.1540f3d9.js"><link rel="prefetch" href="/assets/js/4.dde594c9.js"><link rel="prefetch" href="/assets/js/40.bc77545d.js"><link rel="prefetch" href="/assets/js/41.fe6b364e.js"><link rel="prefetch" href="/assets/js/42.6b17d3ae.js"><link rel="prefetch" href="/assets/js/43.d988bf22.js"><link rel="prefetch" href="/assets/js/44.9b709226.js"><link rel="prefetch" href="/assets/js/45.0797ebde.js"><link rel="prefetch" href="/assets/js/46.d41406d1.js"><link rel="prefetch" href="/assets/js/47.26d992a5.js"><link rel="prefetch" href="/assets/js/48.edf0660d.js"><link rel="prefetch" href="/assets/js/49.e1bd4b64.js"><link rel="prefetch" href="/assets/js/50.17997f4a.js"><link rel="prefetch" href="/assets/js/51.0731d59f.js"><link rel="prefetch" href="/assets/js/52.718863ae.js"><link rel="prefetch" href="/assets/js/53.4d2f7088.js"><link rel="prefetch" href="/assets/js/54.91ac93f6.js"><link rel="prefetch" href="/assets/js/55.3216e5c5.js"><link rel="prefetch" href="/assets/js/56.a2736731.js"><link rel="prefetch" href="/assets/js/57.93476b89.js"><link rel="prefetch" href="/assets/js/58.9984e9d6.js"><link rel="prefetch" href="/assets/js/59.27eeb159.js"><link rel="prefetch" href="/assets/js/6.e9162c19.js"><link rel="prefetch" href="/assets/js/60.83f3f7cd.js"><link rel="prefetch" href="/assets/js/61.322f6435.js"><link rel="prefetch" href="/assets/js/62.af66f292.js"><link rel="prefetch" href="/assets/js/63.777e9119.js"><link rel="prefetch" href="/assets/js/64.05118592.js"><link rel="prefetch" href="/assets/js/65.9ba14b43.js"><link rel="prefetch" href="/assets/js/66.62408b82.js"><link rel="prefetch" href="/assets/js/67.fa72ffa1.js"><link rel="prefetch" href="/assets/js/68.c16dfb41.js"><link rel="prefetch" href="/assets/js/7.f41c39e4.js"><link rel="prefetch" href="/assets/js/8.cd0ad175.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.8fa4990d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.730f6d4f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">既然选择了远方，便只顾风雨兼程 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="nav-item"><a href="/2019/10/20/base-list/" class="nav-link">学习资源</a></li><li class="nav-item"><a href="/handbook/" class="nav-link">前端学习手册</a></li><li class="nav-item"><a href="/tag/Reading%20Notes/" class="nav-link">读书笔记</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">既然选择了远方，便只顾风雨兼程 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="mobile-nav-item"><a href="/2019/10/20/base-list/" class="nav-link">学习资源</a></li><li class="mobile-nav-item"><a href="/handbook/" class="nav-link">前端学习手册</a></li><li class="mobile-nav-item"><a href="/tag/Reading%20Notes/" class="nav-link">读书笔记</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        GitHub + CircleCI 持续化构建博客
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">lili</span> <span itemprop="address">   in shenzhen</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2020-05-07T00:00:00.000Z">
      Thu May 07 2020
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/持续化构建" data-v-42ccfcd5><span data-v-42ccfcd5>持续化构建</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/CircleCI" data-v-42ccfcd5><span data-v-42ccfcd5>CircleCI</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/VuePress" data-v-42ccfcd5><span data-v-42ccfcd5>VuePress</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><p><a href="https://github.com/" target="_blank" rel="noopener noreferrer">GitHub<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 能托管软件项目,对个人开发者来说十分友好，并且它还提供了<a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 功能，让我们可以搭建我们自己的个人博客网站。</p> <h2 id="关联账户"><a href="#关联账户" class="header-anchor">#</a> 关联账户</h2> <p>既然是构建自己的博客网站，就首先要有博客仓库，并且将仓库托管到<code>GitHub</code>上。这里是使用<a href="https://www.vuepress.cn/" target="_blank" rel="noopener noreferrer">VuePress<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>来搭建我们的博客。</p> <p>然后在<a href="https://circleci.com/" target="_blank" rel="noopener noreferrer">CircleCI<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>上，用 <em><strong>GitHub账号</strong></em> 登录<code>CircleCI</code>。登录后，就可以将我们的<code>GitHub</code>仓库和<code>CircleCI</code>连接起来</p> <p><img src="/assets/img/01.6556532b.png" alt="image from dependency"></p> <h2 id="添加-ssh-密钥"><a href="#添加-ssh-密钥" class="header-anchor">#</a> 添加 ssh 密钥</h2> <ol><li>创建密钥</li></ol> <p>通常我们都是使用<code>ssh-keygen -t rsa</code>创建公钥(<code>.pub</code>)和私钥，但是在<code>CircleCI</code>上添加密钥时会报错：</p> <p><img src="/assets/img/02.74ed55b0.png" alt="image from dependency"></p> <p>然后官网提供了<a href="https://circleci.com/docs/2.0/add-ssh-key/" target="_blank" rel="noopener noreferrer">方案<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-sh extra-class"><pre class="language-sh"><code>ssh-keygen <span class="token parameter variable">-m</span> PEM <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-C</span> <span class="token string">&quot;email@example.com&quot;</span>
</code></pre></div><ol start="2"><li>添加密钥</li></ol> <p>生成了<code>ssh</code>密钥后，我们需要将密钥添加到<code>CircleCI</code>上，将公钥添加到<code>GitHub</code>上。</p> <p><code>GitHub</code>添加公钥就不说了，这里只说<code>CircleCI</code>添加密钥。</p> <p><img src="/assets/img/03.0dbfe16e.gif" alt="image from dependency"></p> <blockquote><p>添加密钥时， Hostname 需要填 github.com</p></blockquote> <p>密钥添加完后，就可以看到列表这里有了内容：</p> <p><img src="/assets/img/06.f6756469.png" alt="image from dependency"></p> <p><code>GitHub</code>添加完后：</p> <p><img src="/assets/img/07.d6c9607a.png" alt="image from dependency"></p> <p>可以看到<code>CircleCI</code>和<code>GitHub</code>上<code>fingerprints</code>是相同的。</p> <p>其中，<code>fingerprints</code>我们是需要添加到构建步骤里的:</p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">steps</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">add_ssh_keys</span><span class="token punctuation">:</span>
      <span class="token key atrule">fingerprints</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token string">&quot;80:b8:2a:XX:XX:XX:XX:XX:6c:28&quot;</span>
</code></pre></div><h2 id="构建配置"><a href="#构建配置" class="header-anchor">#</a> 构建配置</h2> <p>在项目根目录下新建文件夹<code>.circleci</code>，然后再新建两个文件，目录就是这样：</p> <div class="language- extra-class"><pre class="language-text"><code>|-- blog // 项目名称
  |--.circleci
      |-- config.yml
      |-- deploy.sh

</code></pre></div><p>其中，<code>config.yml</code>文件是配置文件，<code>deploy.sh</code>是部署脚本.</p> <p>部署脚本在<code>VuePress</code>有<a href="https://www.vuepress.cn/guide/deploy.html#github-pages" target="_blank" rel="noopener noreferrer">教程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>:</p> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token shebang important">#!/usr/bin/env sh</span>

<span class="token comment"># 终止一个错误</span>
<span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>

<span class="token comment"># 构建</span>
<span class="token function">npm</span> run build

<span class="token comment"># 进入生成的构建文件夹</span>
<span class="token builtin class-name">cd</span> blog/.vuepress/dist

<span class="token comment"># 如果你是要部署到自定义域名</span>
<span class="token comment"># echo 'www.example.com' &gt; CNAME</span>

<span class="token function">git</span> init
<span class="token function">git</span> <span class="token function">add</span> <span class="token parameter variable">-A</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">'deploy'</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;before push&quot;</span>
<span class="token comment"># 如果你想要部署到 https://&lt;USERNAME&gt;.github.io</span>
<span class="token function">git</span> push <span class="token parameter variable">-f</span> git@github.com:<span class="token operator">&lt;</span>USERNAME<span class="token operator">&gt;</span>/<span class="token operator">&lt;</span>USERNAME<span class="token operator">&gt;</span>.github.io.git master
<span class="token builtin class-name">echo</span> <span class="token string">&quot;after push&quot;</span>
<span class="token builtin class-name">cd</span> -
</code></pre></div><p>然后在<code>CircleCI</code>里可以看到部署任务列表和部署详情：</p> <p><img src="/assets/img/12.484ab1e8.png" alt="image from dependency"></p> <p><img src="/assets/img/11.464b54ff.png" alt="image from dependency"></p> <h2 id="遇到的问题"><a href="#遇到的问题" class="header-anchor">#</a> 遇到的问题</h2> <h4 id="_1-the-authenticity-of-host-github-com-can-t-be-established"><a href="#_1-the-authenticity-of-host-github-com-can-t-be-established" class="header-anchor">#</a> 1. The authenticity of host 'github.com' can't be established</h4> <p>当<code>CircleCI</code>服务器尝试连接到<code>GitHub</code>的主机时，它可能会提示验证主机密钥。提示是自动化的氪星石：CI环境将无限期挂起，等待用户给出响应。这时我们就只能取消<code>Job</code>：</p> <p><img src="/assets/img/08.73700577.png" alt="image from dependency"></p> <p><strong>解决方法：</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> ssh<span class="token punctuation">-</span>keyscan github.com <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span> ~/.ssh/known_hosts
</code></pre></div><h4 id="_2-github-does-not-provide-shell-access"><a href="#_2-github-does-not-provide-shell-access" class="header-anchor">#</a> 2. GitHub does not provide shell access</h4> <p>这里我们需要执行脚本，但是<code>GitHub</code>可能会提示没有权限。</p> <p><img src="/assets/img/10.6bb5e767.png" alt="image from dependency"></p> <p><strong>解决方法：</strong></p> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> get bash permission
  <span class="token key atrule">command</span><span class="token punctuation">:</span> chmod 755 ./.circleci/deploy.sh
</code></pre></div><h4 id="_3-git-配置"><a href="#_3-git-配置" class="header-anchor">#</a> 3. git 配置</h4> <p><img src="/assets/img/09.56ab9aa4.png" alt="image from dependency"></p> <p>这个简单，只需要按照提示，在部署脚本里加上<code>Git</code>配置就可以了。</p> <h2 id="最终部署脚本"><a href="#最终部署脚本" class="header-anchor">#</a> 最终部署脚本</h2> <ul><li>config.yml</li></ul> <div class="language-yml extra-class"><pre class="language-yml"><code><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
<span class="token key atrule">jobs</span><span class="token punctuation">:</span>
  <span class="token key atrule">build</span><span class="token punctuation">:</span>
    <span class="token key atrule">working_directory</span><span class="token punctuation">:</span> /tmp/workspace
    <span class="token key atrule">docker</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> circleci/node<span class="token punctuation">:</span>latest
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> bash<span class="token punctuation">:</span>4.4.19
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> echo &quot;==============构建开始==================&quot;
      <span class="token punctuation">-</span> checkout
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> sudo apt<span class="token punctuation">-</span>get update
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> sudo apt<span class="token punctuation">-</span>get install git
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> Update npm
          <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token string">'sudo npm install -g npm@latest'</span>
      <span class="token punctuation">-</span> <span class="token key atrule">restore_cache</span><span class="token punctuation">:</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> dependency<span class="token punctuation">-</span>cache<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;package.json&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> Install npm dep
          <span class="token key atrule">command</span><span class="token punctuation">:</span> npm install
      <span class="token punctuation">-</span> <span class="token key atrule">save_cache</span><span class="token punctuation">:</span>
          <span class="token key atrule">key</span><span class="token punctuation">:</span> dependency<span class="token punctuation">-</span>cache<span class="token punctuation">-</span><span class="token punctuation">{</span><span class="token punctuation">{</span> checksum &quot;package.json&quot; <span class="token punctuation">}</span><span class="token punctuation">}</span>
          <span class="token key atrule">paths</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> node_modules
      <span class="token punctuation">-</span> <span class="token key atrule">persist_to_workspace</span><span class="token punctuation">:</span>
          <span class="token key atrule">root</span><span class="token punctuation">:</span> .
          <span class="token key atrule">paths</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> ./*
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> echo &quot;==============构建完成==================&quot;
  <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
    <span class="token key atrule">working_directory</span><span class="token punctuation">:</span> /tmp/workspace
    <span class="token key atrule">docker</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> circleci/node<span class="token punctuation">:</span>latest
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> bash<span class="token punctuation">:</span>4.4.19
    <span class="token key atrule">steps</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">add_ssh_keys</span><span class="token punctuation">:</span>
          <span class="token key atrule">fingerprints</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token string">&quot;80:b8:2a:XX:XX:XX:XX:XX:6c:28&quot;</span>
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> echo &quot;==============部署开始==================&quot;
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> ssh<span class="token punctuation">-</span>keyscan github.com <span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span> ~/.ssh/known_hosts
      <span class="token punctuation">-</span> <span class="token key atrule">attach_workspace</span><span class="token punctuation">:</span>
          <span class="token key atrule">at</span><span class="token punctuation">:</span> /tmp/workspace
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> pwd <span class="token important">&amp;&amp;</span> ls <span class="token punctuation">-</span>al
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> get bash permission
          <span class="token key atrule">command</span><span class="token punctuation">:</span> chmod 755 ./.circleci/deploy.sh
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> Deploy Over SSH
          <span class="token key atrule">command</span><span class="token punctuation">:</span> ./.circleci/deploy.sh
      <span class="token punctuation">-</span> <span class="token key atrule">run</span><span class="token punctuation">:</span> echo &quot;==============部署完成==================&quot;

<span class="token key atrule">workflows</span><span class="token punctuation">:</span>
  <span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token number">2</span>
  <span class="token key atrule">build_and_deploy</span><span class="token punctuation">:</span>
    <span class="token key atrule">jobs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> build
      <span class="token punctuation">-</span> <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
          <span class="token key atrule">requires</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> build
          <span class="token key atrule">filters</span><span class="token punctuation">:</span>
            <span class="token key atrule">branches</span><span class="token punctuation">:</span>
              <span class="token key atrule">only</span><span class="token punctuation">:</span> release
</code></pre></div><blockquote><p>这里我使用 release 分支作为部署分支，因为使用 VuePress 时，构建后，项目的目录会不同，然后 push 到 master 分支后，项目就改变了。再次 push 时，它会要求我们先从 master 分支上 pull 最新代码，这不是我想要的结果，所以用 release 分支作为部署分支。</p></blockquote> <ul><li>deploy.sh</li></ul> <div class="language-sh extra-class"><pre class="language-sh"><code><span class="token shebang important">#!/usr/bin/env sh</span>

<span class="token comment"># 终止一个错误</span>
<span class="token builtin class-name">set</span> <span class="token parameter variable">-e</span>

<span class="token function">git</span> config <span class="token parameter variable">--global</span> user.email <span class="token string">&quot;you@example.com&quot;</span>
<span class="token function">git</span> config <span class="token parameter variable">--global</span> user.name <span class="token string">&quot;your name&quot;</span>


<span class="token comment"># 构建</span>
<span class="token function">npm</span> run build

<span class="token comment"># 进入生成的构建文件夹</span>
<span class="token builtin class-name">cd</span> blog/.vuepress/dist

<span class="token comment"># 如果你是要部署到自定义域名</span>
<span class="token comment"># echo 'www.example.com' &gt; CNAME</span>

<span class="token function">git</span> init
<span class="token function">git</span> <span class="token function">add</span> <span class="token parameter variable">-A</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">'deploy'</span>

<span class="token builtin class-name">echo</span> <span class="token string">&quot;before push&quot;</span>
<span class="token comment"># 如果你想要部署到 https://&lt;USERNAME&gt;.github.io</span>
<span class="token function">git</span> push <span class="token parameter variable">-f</span> git@github.com:<span class="token operator">&lt;</span>USERNAME<span class="token operator">&gt;</span>/<span class="token operator">&lt;</span>USERNAME<span class="token operator">&gt;</span>.github.io.git master
<span class="token builtin class-name">echo</span> <span class="token string">&quot;after push&quot;</span>
<span class="token builtin class-name">cd</span> -
</code></pre></div><p>配置好了之后，我们每次<code>push</code>代码到<code>release</code>分支时，就会自动构建啦，打开我们的个人<code>GitHub Pages</code>网站时，就可以看到我们的博客网站啦。</p></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#关联账户" title="关联账户">关联账户</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#添加-ssh-密钥" title="添加 ssh 密钥">添加 ssh 密钥</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#构建配置" title="构建配置">构建配置</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#遇到的问题" title="遇到的问题">遇到的问题</a></div><div class="vuepress-toc-item vuepress-toc-h2"><a href="#最终部署脚本" title="最终部署脚本">最终部署脚本</a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c4cd884f.js" defer></script><script src="/assets/js/23.d4940eec.js" defer></script><script src="/assets/js/5.5d32c9ea.js" defer></script><script src="/assets/js/9.f1977faa.js" defer></script>
  </body>
</html>
