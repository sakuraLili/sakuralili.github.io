<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>浏览器中的 Event Loop | 既然选择了远方，便只顾风雨兼程</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link ref="icon" href="./public/favicon.icon">
    <meta name="description" content="

通过 HTML5 规范的定义来看 event loop 的定义

&gt; 为了协调时间，用户交互，脚本，界面渲染，网络等等，用户代理必须使用下一节描述的 event loops。event loops 分为两种：浏览器环境及为 Web Worker ...">
    
    <link rel="preload" href="/assets/css/0.styles.730f6d4f.css" as="style"><link rel="preload" href="/assets/js/app.c4cd884f.js" as="script"><link rel="preload" href="/assets/js/23.d4940eec.js" as="script"><link rel="preload" href="/assets/js/5.5d32c9ea.js" as="script"><link rel="preload" href="/assets/js/48.edf0660d.js" as="script"><link rel="prefetch" href="/assets/js/10.a13898e2.js"><link rel="prefetch" href="/assets/js/11.ea480a48.js"><link rel="prefetch" href="/assets/js/12.0623054f.js"><link rel="prefetch" href="/assets/js/13.ef25626c.js"><link rel="prefetch" href="/assets/js/14.37d92c2e.js"><link rel="prefetch" href="/assets/js/15.186b7794.js"><link rel="prefetch" href="/assets/js/16.3a23dbe1.js"><link rel="prefetch" href="/assets/js/17.cf1e4c9d.js"><link rel="prefetch" href="/assets/js/18.733102b1.js"><link rel="prefetch" href="/assets/js/19.eb455b58.js"><link rel="prefetch" href="/assets/js/20.e1adbccc.js"><link rel="prefetch" href="/assets/js/21.70504574.js"><link rel="prefetch" href="/assets/js/22.a40e7218.js"><link rel="prefetch" href="/assets/js/24.e000ab2c.js"><link rel="prefetch" href="/assets/js/25.2fe1472c.js"><link rel="prefetch" href="/assets/js/26.84502e94.js"><link rel="prefetch" href="/assets/js/27.c5d352fe.js"><link rel="prefetch" href="/assets/js/28.8e4ee861.js"><link rel="prefetch" href="/assets/js/29.fb15a9ed.js"><link rel="prefetch" href="/assets/js/3.2bd813b0.js"><link rel="prefetch" href="/assets/js/30.baf8f290.js"><link rel="prefetch" href="/assets/js/31.369fdd21.js"><link rel="prefetch" href="/assets/js/32.c0176c82.js"><link rel="prefetch" href="/assets/js/33.b3200294.js"><link rel="prefetch" href="/assets/js/34.08880f00.js"><link rel="prefetch" href="/assets/js/35.133a227c.js"><link rel="prefetch" href="/assets/js/36.293f2b2b.js"><link rel="prefetch" href="/assets/js/37.f92a5aa5.js"><link rel="prefetch" href="/assets/js/38.11242c63.js"><link rel="prefetch" href="/assets/js/39.1540f3d9.js"><link rel="prefetch" href="/assets/js/4.dde594c9.js"><link rel="prefetch" href="/assets/js/40.bc77545d.js"><link rel="prefetch" href="/assets/js/41.fe6b364e.js"><link rel="prefetch" href="/assets/js/42.6b17d3ae.js"><link rel="prefetch" href="/assets/js/43.d988bf22.js"><link rel="prefetch" href="/assets/js/44.9b709226.js"><link rel="prefetch" href="/assets/js/45.0797ebde.js"><link rel="prefetch" href="/assets/js/46.d41406d1.js"><link rel="prefetch" href="/assets/js/47.26d992a5.js"><link rel="prefetch" href="/assets/js/49.e1bd4b64.js"><link rel="prefetch" href="/assets/js/50.17997f4a.js"><link rel="prefetch" href="/assets/js/51.0731d59f.js"><link rel="prefetch" href="/assets/js/52.718863ae.js"><link rel="prefetch" href="/assets/js/53.4d2f7088.js"><link rel="prefetch" href="/assets/js/54.91ac93f6.js"><link rel="prefetch" href="/assets/js/55.3216e5c5.js"><link rel="prefetch" href="/assets/js/56.a2736731.js"><link rel="prefetch" href="/assets/js/57.93476b89.js"><link rel="prefetch" href="/assets/js/58.9984e9d6.js"><link rel="prefetch" href="/assets/js/59.27eeb159.js"><link rel="prefetch" href="/assets/js/6.e9162c19.js"><link rel="prefetch" href="/assets/js/60.83f3f7cd.js"><link rel="prefetch" href="/assets/js/61.322f6435.js"><link rel="prefetch" href="/assets/js/62.af66f292.js"><link rel="prefetch" href="/assets/js/63.777e9119.js"><link rel="prefetch" href="/assets/js/64.05118592.js"><link rel="prefetch" href="/assets/js/65.9ba14b43.js"><link rel="prefetch" href="/assets/js/66.62408b82.js"><link rel="prefetch" href="/assets/js/67.fa72ffa1.js"><link rel="prefetch" href="/assets/js/68.c16dfb41.js"><link rel="prefetch" href="/assets/js/7.f41c39e4.js"><link rel="prefetch" href="/assets/js/8.cd0ad175.js"><link rel="prefetch" href="/assets/js/9.f1977faa.js"><link rel="prefetch" href="/assets/js/vuejs-paginate.8fa4990d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.730f6d4f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="vuepress-theme-blog__global-layout"><section id="header-wrapper"><header id="header"><div class="header-wrapper"><div class="title"><a href="/" class="nav-link home-link">既然选择了远方，便只顾风雨兼程 </a></div> <div class="header-right-wrap"><ul class="nav"><li class="nav-item"><a href="/" class="nav-link">Blog</a></li><li class="nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="nav-item"><a href="/2019/10/20/base-list/" class="nav-link">学习资源</a></li><li class="nav-item"><a href="/handbook/" class="nav-link">前端学习手册</a></li><li class="nav-item"><a href="/tag/Reading%20Notes/" class="nav-link">读书笔记</a></li></ul> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></div></header></section> <div id="mobile-header"><div class="mobile-header-bar"><div class="mobile-header-title"><a href="/" class="nav-link mobile-home-link">既然选择了远方，便只顾风雨兼程 </a> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></div> <div class="mobile-menu-wrapper"><hr class="menu-divider"> <ul class="mobile-nav"><li class="mobile-nav-item"><a href="/" class="nav-link">Blog</a></li><li class="mobile-nav-item"><a href="/tag/" class="nav-link">Tags</a></li><li class="mobile-nav-item"><a href="/2019/10/20/base-list/" class="nav-link">学习资源</a></li><li class="mobile-nav-item"><a href="/handbook/" class="nav-link">前端学习手册</a></li><li class="mobile-nav-item"><a href="/tag/Reading%20Notes/" class="nav-link">读书笔记</a></li> <li class="mobile-nav-item"><!----></li></ul></div></div></div> <div class="content-wrapper"><div id="vuepress-theme-blog__post-layout"><article itemscope="itemscope" itemtype="https://schema.org/BlogPosting" class="vuepress-blog-theme-content"><header><h1 itemprop="name headline" class="post-title">
        浏览器中的 Event Loop
      </h1> <div class="post-meta"><div itemprop="publisher author" itemtype="http://schema.org/Person" itemscope="itemscope" class="post-meta-author"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-navigation"><polygon points="3 11 22 2 13 21 11 13 3 11"></polygon></svg> <span itemprop="name">lili</span> <span itemprop="address">   in shenzhen</span></div> <div class="post-meta-date"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg> <time pubdate itemprop="datePublished" datetime="2020-02-10T00:00:00.000Z">
      Mon Feb 10 2020
    </time></div> <ul itemprop="keywords" class="post-meta-tags"><li class="post-tag" data-v-42ccfcd5><a href="/tag/JavaScript" data-v-42ccfcd5><span data-v-42ccfcd5>JavaScript</span></a></li><li class="post-tag" data-v-42ccfcd5><a href="/tag/Event Loop" data-v-42ccfcd5><span data-v-42ccfcd5>Event Loop</span></a></li></ul></div></header> <div itemprop="articleBody" class="content__default"><h2 id="event-loop"><a href="#event-loop" class="header-anchor">#</a> <code>event loop</code></h2> <p>通过<a href="https://www.w3.org/TR/html5/webappapis.html#event-loops-definitions" target="_blank" rel="noopener noreferrer"><code>HTML5</code>规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的定义来看<code>event loop</code>的定义</p> <blockquote><p>为了协调时间，用户交互，脚本，界面渲染，网络等等，用户代理必须使用下一节描述的 event loops。event loops 分为两种：浏览器环境及为 Web Worker 服务的。</p></blockquote> <p>在这里只关注浏览器部分，<code>JavaScript</code> 引擎并不是独立运行的，它需要运行在宿主环境中， 所以其实用户代理（<code>user agent</code>）或者称为运行环境或者宿主环境，也就是浏览器。</p> <blockquote><p>每个用户代理必须至少有一个<a href="https://www.w3.org/TR/html5/browsers.html#browsing-context" target="_blank" rel="noopener noreferrer"><code>browsing context event loop</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，但每个<a href="https://www.w3.org/TR/html5/browsers.html#units-of-related-similar-origin-browsing-contexts" target="_blank" rel="noopener noreferrer"><code>unit of related similar-origin browsing contexts</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 最多只能有一个。</p></blockquote> <p>关于<a href="https://www.w3.org/TR/html5/browsers.html#units-of-related-similar-origin-browsing-contexts" target="_blank" rel="noopener noreferrer"><code>unit of related similar-origin browsing contexts</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，节选一部分规范的介绍：</p> <blockquote><p>Each <a href="https://www.w3.org/TR/html5/browsers.html#unit-of-related-browsing-contexts" target="_blank" rel="noopener noreferrer"> unit of related browsing contexts <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> is then further divided into the smallest number of groups such that every member of each group has an <a href="https://www.w3.org/TR/html5/browsers.html#active-document" target="_blank" rel="noopener noreferrer">active document<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with an <a href="https://www.w3.org/TR/html5/browsers.html#concept-origin" target="_blank" rel="noopener noreferrer">origin<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> that, through appropriate manipulation of the document.domain attribute, could be made to be <a href="https://www.w3.org/TR/html5/browsers.html#same-origin-domain" target="_blank" rel="noopener noreferrer">same origin-domain<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with other members of the group, but could not be made the same as members of any other group. Each such group is a unit of related similar-origin browsing contexts.</p></blockquote> <p>简而言之就是一个浏览器环境（<code>unit of related similar-origin browsing contexts.</code>），只能有一个事件循环（<code>event loop</code>）。</p> <h3 id="event-loop做了什么"><a href="#event-loop做了什么" class="header-anchor">#</a> <code>event loop</code>做了什么？</h3> <blockquote><p>每个<code>event loop</code>都有一个或多个 task queues. 一个<a href="https://www.w3.org/TR/html5/webappapis.html#task-queues" target="_blank" rel="noopener noreferrer"> task queue <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>是<code>tasks</code>的有序的列表, 是用来响应如下工作的算法:</p> <ul><li><p>事件</p> <p>在<code>EventTarget</code>触发的时候发布一个事件<code>Event</code> 对象，这通常由一个专属的 task 完成。</p> <p>注意：并不是所有的事件都从是<a href="https://www.w3.org/TR/html5/webappapis.html#task-queues" target="_blank" rel="noopener noreferrer"><code>task queue</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中发布，也有很多是来自其他的 tasks。</p></li> <li><p>解析</p> <p><a href="https://www.w3.org/TR/html5/syntax.html#html-parser" target="_blank" rel="noopener noreferrer"><code>HTML</code>解析器 <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>令牌化然后产生<code>token</code>的过程，是一个典型的<code>task</code>。</p></li> <li><p>回调函数</p></li></ul> <p>一般使用一个特定的<code>task</code>来调用一个回调函数。</p> <ul><li><p>使用资源（其实就是网络）</p> <p>当算法<a href="https://fetch.spec.whatwg.org/#concept-fetch" target="_blank" rel="noopener noreferrer"> 获取<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 到了资源，如果获取资源的过程是非阻塞的，那么一旦获取了部分或者全部的内容将由<code>task</code>来执行这个过程。</p></li> <li><p>响应<code>DOM</code>的操作</p> <p>有一些元素会对<code>DOM</code>的操作产生<code>task</code>，比如当元素被<a href="https://www.w3.org/TR/html5/infrastructure.html#document-inserted-into" target="_blank" rel="noopener noreferrer"> 插入到 <code>document</code> 时<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p></li></ul></blockquote> <p>可以看到，一个页面只有一个<code>event loop</code>，但是一个 <code>event loop</code>可以有多个<code>task queues</code></p> <blockquote><p>每个来自相同<code>task source</code>并由相同<code>event loop</code>（比如，<code>Document</code>的计时器产生的回调函数，<code>Document</code>的鼠标移动产生的事件，<code>Document</code>的解析器产生的 <code>tasks</code>） 管理的<code>task</code>都必须加入到同一个<code>task queue</code>中，可是来自不同  <a href="https://www.w3.org/TR/html5/webappapis.html#task-source" target="_blank" rel="noopener noreferrer"><code>task sources</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 的<code>tasks</code>可能会被排入到不同的<code>task queues</code>中。</p></blockquote> <p>规范对<code>task source</code>进行了分类：</p> <blockquote><p>如下<code>task sources</code> 被大量应用于本规范或其他规范无关的特性中：</p> <ul><li><p><code>DOM</code>操作的<code>task source</code></p> <p>这种<code>task source</code>用来对<code>DOM</code> 的操作进行反应，比如像<code>inserted into the document</code>的非阻塞的行为。</p></li> <li><p>用户操作的<code>task source</code></p> <p>这种<code>task source</code> 用来响应用户的反应，比如鼠标和键盘的事件。这些用来反应用户输入的事件必须由<a href="https://www.w3.org/TR/html5/webappapis.html#user-interaction-task-source" target="_blank" rel="noopener noreferrer"><code>user interaction task source</code> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>来触发并排入<code>tasks queued</code>。</p></li> <li><p>网络<code>task source</code></p> <p>这种<code>task source</code>用来反应网络活动的响应。</p></li> <li><p>时间旅行<code>task source</code></p> <p>这种<code>task source</code>用来将<code>history.back()</code>等<code>API</code>排入<code>task queue</code>。</p></li></ul></blockquote> <p>规范中明确表示了是有多个<code>task queues</code>，并举例说明了这样设计的意义：</p> <blockquote><p>举例来说，一个用户代理可以有一个处理键盘鼠标事件的 <code>task queue</code>（来自<code>user interaction task source</code>)，还有一个<code>task queue</code> 来处理所有其他的。用户代理可以以<code>75%</code> 的几率先处理鼠标和键盘的事件，这样既不会彻底不执行其他 <code>task queues</code>的前提下保证用户界面的响应， 而且不会让来自同一个<code>task source</code>的事件顺序错乱。</p></blockquote> <p>接着：</p> <blockquote><p>当用户代理将要排入任务时，必须将任务排入相关的<code>event loop</code>的<code>task queues</code>。</p></blockquote> <p>这句话很关键，是用户代理（宿主环境/运行环境/浏览器）来控制任务的调度，这里就引出了下面的<code>Web APIs</code>。</p> <p>接下来我么来看看<code>event loop</code>是如何执行<code>task</code>的。</p> <h3 id="处理模型"><a href="#处理模型" class="header-anchor">#</a> 处理模型</h3> <p><code>event loop</code>会在整个页面存在时不停的将<code>task queues</code> 中的函数拿出来执行，具体的规则如下：</p> <p>一个<code>event loop</code>在它存在的必须不断的重复一下的步骤：</p> <ol><li>从<code>task queues</code>中取出<code>event loop</code>的最先添加的 <code>task</code>，如果没有可以选择的<code>task</code>，那么跳到第 <code>Microtasks</code>步。</li> <li>设定<code>event loop</code>当前执行的<code>task</code>为上一步中选择的 <code>task</code>。
执行：执行选中的<code>task</code>。</li> <li>执行：执行选中的<code>task</code>。</li> <li>将<code>event loop</code>的当前执行<code>task</code>设为<code>null</code>。</li> <li>从<code>task queue</code>中将刚刚执行的<code>task</code>移除。</li> <li><code>Microtasks</code>： <a href="https://www.w3.org/TR/html5/webappapis.html#performs-a-microtask-checkpoint" target="_blank" rel="noopener noreferrer">执行<code>microtask</code> 检查点的任务<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li> <li>更新渲染，如果是浏览器环境中的<code>event loop</code>（相对来说就是<code>Worker</code>中的<code>event loop</code>）那么执行以下步骤：</li> <li>如果是<code>Worker</code>环境中的<code>event loop</code>（例如，在<a href="https://www.w3.org/TR/workers/#workerglobalscope" target="_blank" rel="noopener noreferrer"><code>WorkerGlobalScope</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>中运行），可是在<code>event loop</code>的<code>task queues</code>中没有 <code>tasks</code>并且  <a href="https://www.w3.org/TR/workers/#workerglobalscope" target="_blank" rel="noopener noreferrer"><code>WorkerGlobalScope</code> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>对象为关闭的标志，那么销毁<code>event loop</code>，终止这些步骤的执行，恢复到<a href="https://www.w3.org/TR/workers/#run-a-worker" target="_blank" rel="noopener noreferrer"><code>run a worker</code> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的步骤。</li> <li>回到第<code>1</code>步。</li></ol> <h3 id="microtask"><a href="#microtask" class="header-anchor">#</a> <code>microtask</code></h3> <p>规范引出了<code>microtask</code>，</p> <blockquote><p>每个<code>event loop</code>都有一个<code>microtask queue</code>。<code>microtask</code>是一种要排入<a href="/2020/02/10/browser-event-loop/hhttps://www.w3.org/TR/html5/webappapis.html#microtask-queue"><code>microtask queue</code></a>的而不是<code>task queue</code>的任务。有两种<a href="https://www.w3.org/TR/html5/webappapis.html#microtask" target="_blank" rel="noopener noreferrer"><code>microtasks</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：<code>solitary callback microtasks</code>和 <code>compound microtasks</code>。</p></blockquote> <p>规范只介绍了<a href="https://www.w3.org/TR/html5/webappapis.html#solitary-callback-microtasks" target="_blank" rel="noopener noreferrer"><code>solitary callback microtasks</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，<code>compound microtasks</code> 可以先忽略掉。</p> <blockquote><p>当一个<code>microtask</code>要被排入的时候，它必须被排入相关 <code>event loop</code>的<code>microtask queue，microtask</code>的<code>task source</code>是<code>microtask task source</code>.</p></blockquote> <h3 id="microtasks检查点"><a href="#microtasks检查点" class="header-anchor">#</a> <code>microtasks</code>检查点</h3> <p>当用户代理执行到了<code>microtasks</code>检查点的时候，如果<a href="https://www.w3.org/TR/html5/webappapis.html#performing-a-microtask-checkpoint-flag" target="_blank" rel="noopener noreferrer"><code>performing a microtask checkpoint flag</code> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>为 <code>false</code>，则用户代理必须运行下面的步骤：</p> <ol><li>将<code>performing a microtask checkpoint flag</code>置为<code>true</code>。</li> <li>处理<code>microtask queue</code>：如果<code>event loop</code>的 <code>microtask queue</code>是空的，直接跳到<code>Done</code>步。</li> <li>选择<code>event loop</code>的<code>microtask queue</code>中最老的 <code>microtask</code>。</li> <li>设定<code>event loop</code>当前执行的<code>task</code>为上一步中选择的 <code>task</code>。</li> <li>执行：执行选中的<code>task</code>。</li></ol> <blockquote><p>注意：这有可能涉及相关的脚本回调函数，这些回调函数最后都会执行<a href="https://www.w3.org/TR/html5/webappapis.html#clean-up-after-running-script" target="_blank" rel="noopener noreferrer"><code>clean up after running script</code> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，这回导致再次<a href="https://www.w3.org/TR/html5/webappapis.html#performs-a-microtask-checkpoint" target="_blank" rel="noopener noreferrer">执行<code>microtask</code> 检查点的任务<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，这就是我们要使用 <code>performing a microtask checkpoint flag</code>的原因。</p></blockquote> <ol start="6"><li>将<code>event loop</code>的当前执行<code>task</code>设为<code>null</code>。</li> <li>将上一步中执行的<code>microtask</code>从<code>microtask queue</code> 中移除，然后返回 处理<code>microtask queue</code>步骤。</li> <li>完成： 对每一个<a href="https://html.spec.whatwg.org/multipage/webappapis.html#responsible-event-loop" target="_blank" rel="noopener noreferrer"><code>responsible event loop</code> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>就是当前的<code>event loop</code>的<a href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" target="_blank" rel="noopener noreferrer"><code>environment settings object</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，给<a href="https://html.spec.whatwg.org/multipage/webappapis.html#environment-settings-object" target="_blank" rel="noopener noreferrer"><code>environment settings object</code> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>发一个<a href="https://html.spec.whatwg.org/multipage/webappapis.html#notify-about-rejected-promises" target="_blank" rel="noopener noreferrer"><code>rejected promises</code><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>的通知。</li> <li><a href="https://w3c.github.io/IndexedDB/#cleanup-indexed-database-transactions" target="_blank" rel="noopener noreferrer">清理<code>IndexedDB</code> 的事务<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</li> <li>将<code>performing a microtask checkpoint flag</code>设为 <code>false</code>。</li></ol> <p>为啥要用<code>microtask</code>？根据<code>HTML Standard</code>，在每个 <code>task</code>运行完以后，<code>UI</code>都会重渲染，那么在<code>microtask</code> 中就完成数据更新，当前<code>task</code>结束就可以得到最新的<code>UI</code>了。反之如果新建一个<code>task</code> 来做数据更新，那么渲染就会进行两次。</p> <p>整个流程如下图：</p> <p><img src="https://user-gold-cdn.xitu.io/2018/7/25/164d18380a1dccc6?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="image"></p> <h3 id="task-microtask"><a href="#task-microtask" class="header-anchor">#</a> <code>task &amp; microTask</code></h3> <p><code>task</code>主要包含：</p> <ul><li><code>script</code>（整体代码）</li> <li><code>setTimeout</code></li> <li><code>setInterval</code></li> <li><code>setImmediate</code></li> <li><code>I/O</code></li> <li><code>UI rendering</code></li></ul> <p><code>microtask</code>主要包含：</p> <ul><li><code>process.nextTick</code>（<code>Node.js</code>环境）</li> <li><code>Promises</code>（这里指浏览器实现的原生<code>Promise</code>）</li> <li><code>Object.observe</code>（已被<code>MutationObserver</code>替代）</li> <li><code>MutationObserver</code></li> <li><code>postMessage</code></li></ul> <h3 id="web-apis"><a href="#web-apis" class="header-anchor">#</a> <code>Web APIs</code></h3> <p>在上面讲到了用户代理（宿主环境/运行环境/浏览器）来控制任务的调度，<code>task queues</code> 只是一个队列，它并不知道什么时候有新的任务推入，也不知道什么时候任务出队。<code>event loop</code> 会根据规则不断将任务出队，那谁来将任务入队呢？答案是 <code>Web APIs</code>。
我们都知道<code>JavaScript</code> 的执行是单线程的，但是浏览器并不是单线程的，<code>Web APIs</code>就是一些额外的线程，它们通常由<code>C++</code> 来实现，用来处理非同步事件比如<code>DOM</code>事件，<code>http</code> 请求，<code>setTimeout</code>等。他们是浏览器实现并发的入口，对于<code>Node.JavaScript</code>来说，就是一些<code>C++</code>的<code>APIs</code>。</p> <blockquote><p><code>WebAPIs</code>本身并不能直接将回调函数放在函数调用栈中来执行，否则它会随机在整个程序的运行过程中出现。每个 <code>WebAPIs</code>会在其执行完毕的时候将回调函数推入到对应的任务队列中，然后由<code>event loop</code> 按照规则在函数调用栈为空的时候将回调函数推入执行栈中执行。<code>event loop</code> 的基本作用就是检查函数调用栈和任务队列，并在函数调用栈为空时将任务队列中的的第一个任务推入执行栈中，每一个任务都在下一个任务执行前执行完毕。</p></blockquote> <p><code>WebAPIs</code>提供了多线程来执行异步函数，在回调发生的时候，它们会将回调函数和推入任务队列中并传递返回值。</p> <h3 id="参考文献"><a href="#参考文献" class="header-anchor">#</a> 参考文献</h3> <p><a href="https://www.w3.org/TR/html5/webappapis.html#event-loops-definitions" target="_blank" rel="noopener noreferrer"><code>HTML5</code>规范<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/" target="_blank" rel="noopener noreferrer">Tasks, microtasks, queues and schedules<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://juejin.im/post/5b5873a1e51d4519133fbc35" target="_blank" rel="noopener noreferrer">跟着<code>Event loop</code> 规范理解浏览器中的异步机制<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><a href="https://www.zhihu.com/question/55364497/answer/144215284" target="_blank" rel="noopener noreferrer"><code>Vue</code>中如何使用<code>MutationObserver</code> 做批量处理？<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer><!----> <hr> <!----></footer></article> <div class="sticker vuepress-toc"><div class="vuepress-toc-item vuepress-toc-h2 active"><a href="#event-loop" title="event loop">event loop</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#event-loop做了什么" title="event loop 做了什么？">event loop 做了什么？</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#处理模型" title="处理模型">处理模型</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#microtask" title="microtask">microtask</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#microtasks检查点" title="microtasks 检查点">microtasks 检查点</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#task-microtask" title="task &amp; microTask">task &amp; microTask</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#web-apis" title="Web APIs">Web APIs</a></div><div class="vuepress-toc-item vuepress-toc-h3"><a href="#参考文献" title="参考文献">参考文献</a></div></div></div></div> <footer class="footer" data-v-3d9deeb8><div class="footer-left-wrap" data-v-3d9deeb8><ul class="contact" data-v-3d9deeb8></ul></div> <div class="footer-right-wrap" data-v-3d9deeb8><ul class="copyright" data-v-3d9deeb8></ul></div></footer></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c4cd884f.js" defer></script><script src="/assets/js/23.d4940eec.js" defer></script><script src="/assets/js/5.5d32c9ea.js" defer></script><script src="/assets/js/48.edf0660d.js" defer></script>
  </body>
</html>
